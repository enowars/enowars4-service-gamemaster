import ctypes
import struct

MBIG = 2**31-1

class CSRandom():
    def __init__(self, dump_str):
        chunks = [dump_str[n:n+8] for n in range(0, len(dump_str), 8)]
        state = [int(i, 16) for i in chunks]

        self.state = state[:55]

        for i in state[55:]:
            print("received:", i, "\t calculated:", self.next_int())

    def next_int(self):
        res = (self.state[0] - self.state[21])

        if res == MBIG: res -= 1
        if res < 0: res += MBIG

        self.state = self.state[1:] + [res]

        return res

    def prev_int(self):
        p_state = (self.state[20] + self.state[-1])

        if p_state >= MBIG: p_state -= MBIG
        if p_state == MBIG: print("BRANCH DETECTED!")

        res = self.state[-1]
        self.state = [p_state] +  self.state[:-1]
        return res